\documentclass[11pt,fleqn]{article}
\usepackage[top=2cm,bottom=2cm,left=1cm,right=1cm]{geometry}
\usepackage{titlesec} % see below
\usepackage{xcolor} % \color \textcolor
\usepackage{hyperref} % \href
\usepackage[normalem]{ulem} % normalem retains \emph as italic
% \uline \uuline \uwave \sout
\usepackage{enumitem}
% \begin{enumerate}[label=\Alpha*.]
% \begin{enumerate}[label=\(\bullet\)]
\usepackage{graphicx}
% \includegraphicswidth=0.5\textwidth,trim=[0cm 0cm 0cm 0cm,clip]{file.png}
\usepackage{pdfpages} % \includepdf[pages=1]{file.pdf}
% for prose
%\usepackage[doublespacing]{setspace}
\usepackage{csquotes} % \blockquote
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\rmdefault}{cmr}
\renewcommand{\sfdefault}{cmss}
\renewcommand{\ttdefault}{cmtt}
\renewcommand{\familydefault}{\rmdefault}
\setlength{\titlewidth}{\textwidth}

\titlespacing{\section}{0pt}{0pt}{0pt}
\titlespacing{\subsection}{0pt}{0pt}{0pt}
\titlespacing{\subsubsection}{0pt}{0pt}{0pt}
\titlespacing{\paragraph}{0pt}{0pt}{0pt}
% https://www.overleaf.com/learn/latex/How_to_write_a_LaTeX_class_file_and_design_your_own_CV_(Part_1)
% \titleformat{command}[shape]{format}{label}{sep}{before-code}[after-code]
\titleformat{\section}         % Customise the \section command 
    [hang]
    {\Large\ttfamily\raggedright} % Make the \section headers large (\Large),
                               % small capitals (\scshape) and left aligned (\raggedright)
    {}{0em}                      % Can be used to give a prefix to all sections, like 'Section ...'
    {}                           % Can be used to insert code before the heading
    [\titlerule]                 % Inserts a horizontal line after the heading
\titleformat{\subsection}
    [hang]
    {\large\ttfamily\raggedright}
    {}{0em}
    {}
    []
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{mathpartir}
\usepackage{latexsym}
\usepackage{stmaryrd}
\usepackage{amssymb}
\usepackage{thmtools}
\usepackage{tikz}
% https://tex.stackexchange.com/questions/12678/squiggly-arrows-in-tikz
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{arrows.meta}
% https://tex.stackexchange.com/questions/317121/automatically-adding-page-breaks-into-long-array-environments
\usepackage{array}
\usepackage{longtable}
\newcolumntype{L}{>{\(}l<{\)}}
\newcolumntype{C}{>{\(}c<{\)}}
\newcolumntype{R}{>{\(}r<{\)}}
\setlength\tabcolsep{5pt}

%% Joshua Dunfield macros
\def\OPTIONConf{1}%
\usepackage{joshuadunfield}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% color defs
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\definecolor{red}{HTML}{800000}
\definecolor{green}{HTML}{008000}
\definecolor{blue}{HTML}{000080}
\definecolor{orange}{HTML}{D08000}
\definecolor{purple}{HTML}{800080}
\definecolor{teal}{HTML}{008080}
\definecolor{black}{HTML}{000000}
\definecolor{grey}{HTML}{808080}
\newcommand{\red}[1]{\textcolor{red}{#1}}
\newcommand{\green}[1]{\textcolor{green}{#1}}
\newcommand{\blue}[1]{\textcolor{blue}{#1}}
\newcommand{\orange}[1]{\textcolor{orange}{#1}}
\newcommand{\purple}[1]{\textcolor{purple}{#1}}
\newcommand{\teal}[1]{\textcolor{teal}{#1}}
\newcommand{\black}[1]{\textcolor{black}{#1}}
\newcommand{\grey}[1]{\textcolor{grey}{#1}}
\newcommand{\redtt}[1]{\red{\mathtt{#1}}}
\newcommand{\greentt}[1]{\green{\mathtt{#1}}}
\newcommand{\bluett}[1]{\blue{\mathtt{#1}}}
\newcommand{\orangett}[1]{\orange{\mathtt{#1}}}
\newcommand{\purplett}[1]{\purple{\mathtt{#1}}}
\newcommand{\tealtt}[1]{\teal{\mathtt{#1}}}
\newcommand{\blacktt}[1]{\black{\mathtt{#1}}}
\newcommand{\greytt}[1]{\grey{\mathtt{#1}}}
\newcommand{\redit}[1]{\red{\mathit{#1}}}
\newcommand{\greenit}[1]{\green{\mathit{#1}}}
\newcommand{\blueit}[1]{\blue{\mathit{#1}}}
\newcommand{\orangeit}[1]{\orange{\mathit{#1}}}
\newcommand{\purpleit}[1]{\purple{\mathit{#1}}}
\newcommand{\tealit}[1]{\teal{\mathit{#1}}}
\newcommand{\blackit}[1]{\black{\mathit{#1}}}
\newcommand{\greyit}[1]{\grey{\mathit{#1}}}
% traditional hazel hole color
\newcommand{\violettt}[1]{\textcolor{violet}{\mathtt{#1}}}
\newcommand{\violetit}[1]{\textcolor{violet}{\mathit{#1}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% syntax
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\knd}[1][]{\redit{\kappa#1}}
\newcommand{\utyp}[1][]{\greenit{\hat{\tau#1}}}
\newcommand{\typ}[1][]{\greenit{\tau#1}}
\newcommand{\utypvar}[1][]{\greenit{t#1}}
\newcommand{\typvar}[1][]{\greenit{t#1}}
\newcommand{\uexp}[1][]{\blueit{\hat{\delta#1}}}
\renewcommand{\exp}[1][]{\blueit{\delta#1}}
\newcommand{\uexpvar}[1][]{\blueit{x#1}}
\newcommand{\expvar}[1][]{\blueit{x#1}}
\newcommand{\sigknd}[1][]{\orangeit{\xi#1}}
\newcommand{\usig}[1][]{\purpleit{\hat{\sigma#1}}}
\newcommand{\sig}[1][]{\purpleit{\sigma#1}}
\newcommand{\usigvar}[1][]{\purpleit{s#1}}
\newcommand{\sigvar}[1][]{\purpleit{s#1}}
\newcommand{\umod}[1][]{\tealit{\hat{\mu#1}}}
\renewcommand{\mod}[1][]{\tealit{\mu#1}}
\newcommand{\umodvar}[1][]{\tealit{m#1}}
\newcommand{\modvar}[1][]{\tealit{m#1}}
\newcommand{\lab}[1][]{\mathit{lab#1}}

\newcommand{\Type}{\redtt{Type}}
\newcommand{\SKind}[1]{\redtt{S(#1)}}
\newcommand{\KHole}{\redtt{KHole}}
\newcommand{\DepFunKind}[2]{\redtt{\Pi_{#1}.{#2}}}
\newcommand{\DepProdKind}[2]{\redtt{\Sigma_{#1}.{#2}}}

\newcommand{\TypCFun}[2]{\greentt{\lambda #1.#2}}
\newcommand{\TypCAp}[2]{\greentt{#1~#2}}
\newcommand{\TypCPair}[2]{\greentt{\langle #1, #2\rangle}}
\newcommand{\TypCPairPrjL}[1]{\greentt{\pi_1~#1}}
\newcommand{\TypCPairPrjR}[1]{\greentt{\pi_2~#1}}
\newcommand{\ListTyp}[1]{\greentt{[#1]}}
% use violet instead of green?
\newcommand{\TypCHole}[1][]{\greentt{\llparenthesis #1 \rrparenthesis}}
\newcommand{\ModTypPrj}[2]{\greentt{#1.#2}}

\newcommand{\Int}{\greentt{Int}}
\newcommand{\Float}{\greentt{Float}}
\newcommand{\Bool}{\greentt{Bool}}

\newcommand{\uLetSig}[2]{\purplett{signature~#1=#2}\bluett{~in~\uexp}}
\newcommand{\LetSig}[2]{\purplett{signature~#1=#2}\bluett{~in~\exp}}
\newcommand{\uLetMod}[2]{\tealtt{module~#1=#2}\bluett{~in~\uexp}}
\newcommand{\LetMod}[2]{\tealtt{module~#1=#2}\bluett{~in~\exp}}
\newcommand{\uLetFunctor}[2]{\tealtt{functor~#1=#2}\bluett{~in~\uexp}}
\newcommand{\LetFunctor}[2]{\tealtt{functor~#1=#2}\bluett{~in~\exp}}
\newcommand{\uModTermPrj}[2]{\bluett{#1.#2}}
\newcommand{\ModTermPrj}[2]{\bluett{#1.#2}}

\newcommand{\Sig}[1]{\purplett{\{#1\}}}
\newcommand{\FunctorSig}[2]{\purplett{\Pi_{#1}.{#2}}}
\newcommand{\SigHole}[1][]{\purplett{\llparenthesis#1\rrparenthesis}}

\newcommand{\Struct}[1]{\tealtt{\{#1\}}}
\newcommand{\Functor}[2]{\tealtt{\lambda #1.#2}}
\newcommand{\FunctorAp}[2]{\tealtt{#1~#2}}
\newcommand{\SubModulePrj}[2]{\tealtt{#1.#2}}
\newcommand{\ModHole}[1][]{\tealtt{\llparenthesis#1\rrparenthesis}}


\newcommand{\usbnd}{\greyit{\hat{sbnd}}}
\newcommand{\sbnd}{\greyit{sbnd}}
\newcommand{\usbnds}{\greyit{\hat{sbnds}}}
\newcommand{\sbnds}{\greyit{sbnds}}
\newcommand{\usdec}{\greyit{\hat{sdec}}}
\newcommand{\sdec}{\greyit{sdec}}
\newcommand{\usdecs}{\greyit{\hat{sdecs}}}
\newcommand{\sdecs}{\greyit{sdecs}}

\newcommand{\OpaqueTypeSdec}[1]{\greentt{type~#1}}
\newcommand{\TransparentTypeSdec}[2]{\greentt{type~#1 = #2}}
\newcommand{\ValSdec}[2]{\bluett{val~#1\TypAnn #2}}
\newcommand{\ModSdec}[2]{\tealtt{module~#1\SigAnn #2}}
\newcommand{\FunctorSdec}[2]{\tealtt{functor~#1\SigAnn #2}}

\newcommand{\TypeSbnd}[2]{\greentt{type~#1 = #2}}
\newcommand{\ValSbnd}[2]{\bluett{let~#1 = #2}}
\newcommand{\ModSbnd}[2]{\tealtt{module~#1 = #2}}
\newcommand{\FunctorSbnd}[2]{\tealtt{functor~#1 = #2}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% misc
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand*{\ExpVarCtx}{\Gamma}
\newcommand*{\TypVarCtx}{\Phi}
\newcommand*{\ModVarCtx}{\Xi}
\newcommand*{\SigVarCtx}{\Psi}
\newcommand*{\HoleCtx}{\Delta}
\newcommand{\dom}[1]{\mathsf{dom(}#1\mathsf{)}}
\newcommand{\val}[1]{\mathsf{val(}#1\mathsf{)}}
\newcommand{\type}[1]{\mathsf{type(}#1\mathsf{)}}
\newcommand{\submodule}[1]{\mathsf{submodule(}#1\mathsf{)}}

\newcommand{\hintpagebreak}{\pagebreak[3]} % 0-4; 2 too weak, 4 too strong
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% judgements
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\TypAsc}{\black{:}}
\newcommand{\TypAssump}{\black{:}}
\newcommand{\TypAnn}{\black{:}}
\newcommand{\KndAsc}{\black{::}}
\newcommand{\KndAssump}{\black{::}}
\newcommand{\KndAnn}{\black{::}}
\newcommand{\SigAsc}{\black{:_{\mod}}}
\newcommand{\SigAssump}{\black{:_{\mod}}}
\newcommand{\SigAnn}{\black{:_{\mod}}}

\newcommand{\ConsistentSubkind}[3]{\mathrm{#1 \vdash #2 \lesssim #3}}
\newcommand{\Syn}[3]{#1 \vdash #2~\Rightarrow~#3}
\newcommand{\Ana}[3]{#1 \vdash #2~\Leftarrow~#3}
\newcommand{\SynElab}[5]{#1 \vdash #2~\Rightarrow~#3 \rightsquigarrow #4 \dashv #5}
\newcommand{\AnaElab}[5]{#1 \vdash #2~\Leftarrow~#3 \rightsquigarrow #4 \dashv #5}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\pagenumbering{gobble}
\nonfrenchspacing
%\frenchspacing % when monospaced
\begin{document}
\title{Hazel PHI: 10-modules}
\author{}
\date{\today}
\maketitle
\section{prerequisites}
\subsection*{}
\begin{itemize}
    \item Hazel PHI: 9-type-aliases-redux
        \begin{itemize}
            \item \href{https://github.com/hazelgrove/phi/tree/9-type-aliases-redux}{github}
            \item current commit: 4410cd565ce717707e580e44f64868d3175fe2a6
        \end{itemize}
    \item (optional) Hazel PHI: 1-labeled-tuples
        \begin{itemize}
            \item \href{https://github.com/hazelgrove/phi/tree/1-labeled-tuples}{github}
            \item current commit: 0a7d0b53ee7286d03ea3be13a7ac91a86f1c90b1
        \end{itemize}
\end{itemize}
\section{how to read}
\subsection*{}
\begin{tabular}{rlrl}
    \red{800000} & \red{kinds} & \orange{D08000} & \orange{signature kind} \\
    \green{008000} & \green{types (constructors)} & \purple{800080} & \purple{signatures} \\
    \blue{000080} & \blue{terms} & \teal{008080} & \teal{modules} \\
\end{tabular}
\section{notes}
\subsection*{}
\begin{tikzpicture}[
    kind/.style={circle, draw=red!100, fill=red!10, thick},
    type/.style={circle, draw=green!100, fill=green!10, thick},
    term/.style={circle, draw=blue!100, fill=blue!10, thick},
    signature kind/.style={rectangle, draw=orange!100, fill=orange!10, thick},
    signature/.style={rectangle, draw=purple!100, fill=purple!10, thick},
    module/.style={rectangle, draw=teal!100, fill=teal!10, thick},
    ->/.style={line join=round, decorate, decoration={zigzag, segment length=4, amplitude=.9, post=lineto, post length=10pt}},
    note/.style={rectangle, thick},
    ]
    \node[kind](knd) at (0, 4){$\knd$};
    \node[type](utyp) at (-1, 2){$\utyp$};
    \node[type](typ) at (1, 2){$\typ$};
    \node[term](uexp) at (-1, 0){$\uexp$};
    \node[term](exp) at (1, 0){$\exp$};
    \node[signature kind](sigknd) at (4, 5){$\sigknd$};
    \node[signature](usig) at (3, 3){$\usig$};
    \node[signature](sig) at (5, 3){$\sig$};
    \node[module](umod) at (3, 1){$\umod$};
    \node[module](mod) at (5, 1){$\mod$};
    %\node[note] at (7, 2){$\utyp := \typ$};
    %\node[note] at (7, 3){$\usig := \sig$};
    %\node[note] at (7, 1){$\umod := \mod$};
    \node[note] at (0.7, 4){$\lesssim$};
    \node[note] at (4.7, 5){$\lesssim$};
    \draw[->](utyp.east)--(typ.west);
    \draw[->](uexp.east)--(exp.west);
    \draw[->](usig.east)--(sig.west);
    \draw[->](umod.east)--(mod.west);
    \node[draw=none, shift={(-0.1, 0)}] at (typ.west){$>$};
    \node[draw=none, shift={(-0.1, 0)}] at (exp.west){$>$};
    \node[draw=none, shift={(-0.1, 0)}] at (sig.west){$>$};
    \node[draw=none, shift={(-0.1, 0)}] at (mod.west){$>$};
    \draw[-{Implies}, double]([shift={(-0.1, 0)}]uexp.north)--([shift={(-0.1, 0)}]typ.south);
    \draw[-{Implies}, double]([shift={(0.1, 0)}]typ.south)--([shift={(0.1, 0)}]uexp.north);
    \draw[-{Implies}, double]([shift={(-0.1, 0)}]utyp.north)--([shift={(-0.1, 0)}]knd.south);
    \draw[-{Implies}, double]([shift={(0.1, 0)}]knd.south)--([shift={(0.1, 0)}]utyp.north);
    \draw[-{Implies}, double]([shift={(-0.1, 0)}]typ.north)--([shift={(-0.1, 0)}]knd.south);
    \draw[-{Implies}, double]([shift={(0.1, 0)}]knd.south)--([shift={(0.1, 0)}]typ.north);
    \draw[-{Implies}, double]([shift={(-0.1, 0)}]umod.north)--([shift={(-0.1, 0)}]sig.south);
    \draw[-{Implies}, double]([shift={(0.1, 0)}]sig.south)--([shift={(0.1, 0)}]umod.north);
    \draw[-{Implies}, double]([shift={(-0.1, 0)}]usig.north)--([shift={(-0.1, 0)}]sigknd.south);
    \draw[-{Implies}, double]([shift={(0.1, 0)}]sigknd.south)--([shift={(0.1, 0)}]usig.north);
    \draw[-{Implies}, double]([shift={(-0.1, 0)}]sig.north)--([shift={(-0.1, 0)}]sigknd.south);
    \draw[-{Implies}, double]([shift={(0.1, 0)}]sigknd.south)--([shift={(0.1, 0)}]sig.north);
    % https://tex.stackexchange.com/questions/71478/how-to-center-one-node-exactly-between-two-others-with-tikz
    \path (exp)--(typ) node[midway]{$\TypAsc$};
    \path (mod)--(sig) node[midway]{$\SigAsc$ ?};
\end{tikzpicture}
\subsection*{}
external typ/sig/mod syntax not written out yet (waiting for construction dust to settle);
patterns not handled yet-- will be left till end.
\section{syntax}
\begin{longtable}{RCRLR}
    \textrm{kind} & \knd & ::=
                  & \Type & \textrm{kind of types} \\
                  && \vert & \SKind{\typ} & \textrm{singleton kind} \\
                  && \vert & \KHole & \textrm{kind hole} \\
                  % functors?
                  && \vert & \DepFunKind{\typvar\KndAnn\knd[_1]}{\knd[_2]} & \textrm{dependent function kind} \\
                  %&& \vert & \DepProdKind{\typvar\KndAnn\knd[_1]}{\knd[_2]} & \textrm{dependent product kind} \\
    \hintpagebreak
    \textrm{HTyp} & \typ & ::=
                           & \typvar & \textrm{type variable} \\
                           && \vert & \greenit{bse} & \textrm{base type} \\
                           && \vert & \greentt{\typ[_1] \oplus \typ[_2]} & \textrm{type binop} \\
                           && \vert & \ListTyp{\typ} & \textrm{list type} \\
                           % functors?
                           && \vert & \TypCFun{\typvar\KndAnn\knd}{\typ} & \textrm{type function} \\
                           && \vert & \TypCAp{\typ[_1]}{\typ[_2]} & \textrm{type application} \\
                           %&& \vert & \TypCPair{\typ[_1]}{\typ[_2]} & \textrm{type pair} \\
                           %&& \vert & \TypCPairPrjL{\typ} & \textrm{type projection} \\
                           %&& \vert & \TypCPairPrjR{\typ} & \textrm{type projection} \\
                           % to compare against module term projection
                           && \vert & \greentt{\{\lab[_1] \hookrightarrow \typ[_1], ...~\lab[_n] \hookrightarrow \typ[_n]\}} & \textrm{labelled product type (record)} \\
                           && \vert & \ModTypPrj{\mod}{\lab} & \textrm{module type projection} \\
                           && \vert & \TypCHole & \textrm{empty type hole} \\
                           && \vert & \TypCHole[\typ] & \textrm{nonempty type hole} \\
    \hintpagebreak
    \textrm{base type} & \greenit{bse} & ::=
                       & \Int \\
                       && \vert & \Float \\
                       && \vert & \Bool \\
    \hintpagebreak
    \textrm{HTyp BinOp} & \greenit{\oplus} & ::=
                   & \greentt{\times} \\
                   && \vert & \greentt{+} \\
                   && \vert & \greentt{\rightarrow}\\
    \hintpagebreak
    \textrm{external expression} & \uexp & ::=
                                 & ... \\
                                 && \vert & \uexpvar \\
                                 && \vert & \uLetSig{\usigvar}{\usig} \\
                                 && \vert & \uLetMod{\umodvar}{\umod} \\
                                 && \vert & \uLetMod{\umodvar\SigAnn\usigvar}{\umod} \\
                                 && \vert & \uLetFunctor{something}{something} \\
                                 && \vert & \uModTermPrj{\umod}{\lab} & \textrm{module term projection} \\
    \hintpagebreak
    \textrm{internal expression} & \exp & ::=
                                 & ... \\
                                 && \vert &  \expvar \\
                                 && \vert & \LetSig{\sigvar}{\sig} \\
                                 && \vert & \LetMod{\modvar\SigAnn\sigvar}{\mod} \\
                                 && \vert & \LetFunctor{something}{something} \\
                                 && \vert & \ModTermPrj{\mod}{\lab} & \textrm{module term projection} \\
    \hintpagebreak
    \textrm{signature kind} & \sigknd & ::=
                        & & \\
    \hintpagebreak
    \textrm{signature} & \sig & ::=
                       & \sigvar & \textrm{signature variable} \\
                       && \vert & \Sig{\sdecs} & \textrm{structure signature} \\
                       && \vert & \FunctorSig{\modvar\SigAnn\sig[_1]}{\sig[_2]} & \textrm{functor signature} \\
                       && \vert & \SigHole & \textrm{empty signature hole} \\
                       && \vert & \SigHole[\sigvar] & \textrm{nonempty signature hole} \\
    \hintpagebreak
    \textrm{module} & \mod & ::=
                    & \modvar & \textrm{module variable} \\
                    && \vert & \Struct{\sbnds} & \textrm{structure} \\
                    && \vert & \Functor{\modvar\SigAnn\sig}{\mod} & \textrm{functor} \\
                    && \vert & \FunctorAp{\mod[_1]}{\mod[_2]} & \textrm{functor application} \\
                    && \vert & \SubModulePrj{\mod}{\lab} & \textrm{submodule projection} \\
                    && \vert & \ModHole & \textrm{empty module hole} \\
                    && \vert & \ModHole[\mod] & \textrm{nonempty module hole} \\
    \hintpagebreak
    \textrm{signature declarations} & \sdecs & ::=
                                & \cdot \\
                                && \vert & \sdec, \sdecs\\
    \hintpagebreak
    \textrm{signature declaration} & \sdec & ::=
                                   & \OpaqueTypeSdec{\lab} \\
                                   && \vert & \TransparentTypeSdec{\lab}{\typ} \\
                                   && \vert & \ValSdec{\lab}{\typ} \\
                                   && \vert & \ModSdec{\lab}{\sig} \\
                                   && \vert & \FunctorSdec{\lab}{\sig} \\
    \hintpagebreak
    \textrm{structure bindings} & \sbnds & ::=
                                & \cdot \\
                                && \vert & \sbnd, \sbnds \\
    \hintpagebreak
    \textrm{structure binding} & \sbnd & ::=
                               & \TypeSbnd{\typvar}{\typ} \\
                               && \vert & \ValSbnd{\expvar\TypAnn\typ}{\exp} \\
                               && \vert & \ModSbnd{\modvar}{\mod} \\
                               && \vert & \ModSbnd{\modvar\SigAnn\sigvar}{\mod} \\
                               && \vert & \FunctorSbnd{\modvar\SigAnn\sigvar}{\mod} \\
\end{longtable}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% rules
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{contexts}
\subsection*{}
\begin{minipage}{\textwidth}
    \(\ExpVarCtx, \expvar\TypAssump\typ; \TypVarCtx, \typvar\KndAssump\knd; \ModVarCtx, \modvar\SigAssump\sig; \HoleCtx, ?\)
\end{minipage}
\section{statics}
\subsection*{}
\begin{minipage}{\textwidth}
    \judgbox{\ConsistentSubkind{\HoleCtx;\TypVarCtx}{\knd[_1]}{\knd[_2]}}{$\knd[_1]$ is a consistent subkind of $\knd[_2]$}
    \begin{mathpar}
        \inferrule[KCSubsumption]{test}{test}
    \end{mathpar}
\end{minipage}
\section{elab}
\subsection*{}
\begin{minipage}{\textwidth}
    \judgbox{\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\uexp}{\typ}{\exp}{\HoleCtx}}{$\uexp$ synthesizes type $\typ$ and elaborates to $\exp$ with hole context $\HoleCtx$}
    \begin{mathpar}
        \inferrule[...]{ }{ }
        \and
        \inferrule[SynElabLetMod]{
            \SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umod}{\sig}{\mod}{\HoleCtx_1} \\
            \SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx, \modvar\SigAssump\sig}{\uexp}{\typ}{\exp}{\HoleCtx_2} \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\uLetMod{\umodvar}{\umod}}{\typ}
            {\LetMod{\modvar}{\mod}}{\HoleCtx_1\union\HoleCtx_2}}
        \and
        \inferrule[SynElabLetModAnn]{
            \SynElab{\TypVarCtx;\ModVarCtx}{\usig}{\sigknd}
                {\sig}{\HoleCtx_1} \\
            \AnaElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umod}{\sig}
                {\mod}{\HoleCtx_2} \\
            \SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx, \modvar\SigAssump\sig}{\uexp}{\typ}
                {\exp}{\HoleCtx_3} \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\uLetMod{\umodvar\SigAnn\usig}{\umod}}{\typ}
            {\LetMod{\modvar\SigAnn\sig}{\mod}}{\HoleCtx_1\union\HoleCtx_2\union\HoleCtx_3}}
        \and
        \inferrule[SynElabModTermPrj]{
            \SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umod}{\sig}
                {\mod}{\HoleCtx} \\
            \Syn{\TypVarCtx;\ModVarCtx}{\sig}{\sigknd} \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\uModTermPrj{\umod}{\lab}}{\typ}
            {\ModTermPrj{\mod}{\lab}}{\HoleCtx}}
    \end{mathpar}
\end{minipage}
\begin{minipage}{\textwidth}
    \judgbox{\SynElab{\TypVarCtx;\ModVarCtx}{\utyp}{\knd}{\typ}{\HoleCtx}}{$\utyp$ synthesizes kind $\knd$ and elaborates to $\typ$ with hole context $\HoleCtx$}
    \begin{mathpar}
        \inferrule[...]{ }{ }
        \and
        \inferrule[SynElabModTypPrj]{
            \SynElab{\TypVarCtx;\ModVarCtx}{\umodvar}{\sig}
                {\modvar}{\HoleCtx} \\
            something \sig \knd \\
        }
        {\SynElab{\TypVarCtx;\ModVarCtx}{\ModTypPrj{\umodvar}{\lab}}{\knd}
            {\ModTypPrj{\modvar}{\lab}}{\HoleCtx}}
    \end{mathpar}
\end{minipage}
\begin{minipage}{\textwidth}
    \judgbox{\AnaElab{\TypVarCtx;\ModVarCtx}{\utyp}{\knd}{\typ}{\HoleCtx}}{$\utyp$ analyzes against kind $\knd$ and elaborates to $\typ$ with hole context $\HoleCtx$}
\end{minipage}
\begin{minipage}{\textwidth}
    \judgbox{\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umod}{\sig}{\mod}{\HoleCtx}}{$\umod$ synthesizes signature $\sig$ and elaborates to $\mod$ with hole context $\HoleCtx$}
    \begin{mathpar}
        \inferrule[SynElabModVar]{
            \umodvar\SigAssump\sig \in \ModVarCtx \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umodvar}{\sig}
            {\modvar}{\cdot}}
        \and
        \inferrule[SynElabModVarFail]{
            \umodvar \notin \dom{\ModVarCtx} \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umodvar}{\SigHole}
            {\ModHole[\modvar]^u}{u\SigAssump\SigHole}}
        \and
        \inferrule[SynElabConsStruct]{
            \SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\usbnd}{\sdec}
                {\sbnd}{\HoleCtx_1} \\
            \SynElab{\ExpVarCtx, \val{\sdec};\TypVarCtx, \type{\sdec};\ModVarCtx, \submodule{\sdec}}{\Struct{\usbnds}}{\Sig{\sdecs}}
                {\Struct{\sbnds}}{\HoleCtx_2} \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\Struct{\usbnd, \usbnds}}{\Sig{\sdec, \sdecs}}
            {\Struct{\sbnd, \sbnds}}{\HoleCtx_1\union\HoleCtx_2}}
        \and
        \inferrule[SynElabNilStruct]{
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\Struct{\cdot}}{\Sig{\cdot}}
            {\Struct{\cdot}}{\cdot}}
        \and
        \inferrule[SynElabEmptyModHole]{
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\ModHole^u}{\SigHole}
            {\ModHole^u}{u\SigAssump\SigHole}}
        \and
        \inferrule[SynElabNonemptyModHole]{
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\ModHole[\umodvar]^u}{\SigHole}
            {\ModHole[\modvar]^u}{u\SigAssump\SigHole}}
        \and
        \inferrule[functor stuff]{
        }
        { }
    \end{mathpar}
\end{minipage}
\begin{minipage}{\textwidth}
    \judgbox{\AnaElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umod}{\sig}{\mod}{\HoleCtx}}{$\umod$ analyzes against signature $\sig$ and elaborates to $\mod$ with hole context $\HoleCtx$}
    \begin{mathpar}
        \inferrule[AnaElabModSubsumption]{
            \SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umod}{\sig}
                {\mod}{\HoleCtx} \\
        }
        {\AnaElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umod}{\sig}
            {\mod}{\HoleCtx}}
    \end{mathpar}
\end{minipage}
\begin{minipage}{\textwidth}
    \judgbox{\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\usbnd}{\sdec}{\sbnd}{\HoleCtx}}{$\usbnd$ synthesizes declaration $\sdec$ and elaborates to $\sbnd$ with hole context $\HoleCtx$}
    \begin{mathpar}
        \inferrule[SynElabTypeSbnd]{
            \SynElab{\TypVarCtx;\ModVarCtx}{\utyp}{\knd}
                {\typ}{\HoleCtx} \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\TypeSbnd{\utypvar}{\utyp}}{\TransparentTypeSdec{\typvar}{\typ}}
            {\TypeSbnd{\typvar}{\typ}}{\HoleCtx}}
        \and
        \inferrule[SynElabValSbnd]{
            \SynElab{\TypVarCtx;\ModVarCtx}{\utyp}{\knd}
                {\typ}{\HoleCtx_1} \\
            \AnaElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\uexp}{\typ}
                {\exp}{\HoleCtx_2} \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\ValSbnd{\uexpvar\TypAnn\utyp}{\uexp}}{\ValSdec{\expvar}{\typ}}
            {\ValSbnd{\expvar\TypAnn\typ}{\exp}}{\HoleCtx_1\union\HoleCtx_2}}
        \and
        \inferrule[SynElabModSbnd]{
            \SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umod}{\sig}
                {\mod}{\HoleCtx} \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\ModSbnd{\umodvar}{\umod}}{\ModSdec{\modvar}{\sig}}
        {\ModSbnd{\modvar\SigAnn\sig}{\mod}}{\HoleCtx}}
        \and
        \inferrule[SynElabModAnnSbnd]{
            \SynElab{\TypVarCtx;\ModVarCtx}{\usig}{\sigknd}
                {\sig}{\HoleCtx_1} \\
            \AnaElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\umod}{\sig}
                {\mod}{\HoleCtx_2} \\
        }
        {\SynElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\ModSbnd{\umodvar\SigAnn\usig}{\umod}}{\ModSdec{\modvar}{\sig}}
        {\ModSbnd{\modvar\SigAnn\sig}{\mod}}{\HoleCtx_1\union\HoleCtx_2}}
    \end{mathpar}
\end{minipage}
\begin{minipage}{\textwidth}
    \judgbox{\AnaElab{\ExpVarCtx;\TypVarCtx;\ModVarCtx}{\usbnd}{\sdec}{\sbnd}{\HoleCtx}}{$\usbnd$ analyzes against declaration $\sdec$ and elaborates to $\sbnd$ with hole context $\HoleCtx$}
\end{minipage}
\begin{minipage}{\textwidth}
    \judgbox{\SynElab{\TypVarCtx;\ModVarCtx}{\usig}{\sigknd}{\sig}{\HoleCtx}}{$\usig$ synthesizes signature kind $\sigknd$ and elaborates to $\sig$ with hole context $\HoleCtx$}
\end{minipage}
\begin{minipage}{\textwidth}
    \judgbox{\AnaElab{\TypVarCtx;\ModVarCtx}{\usig}{\sigknd}{\sig}{\HoleCtx}}{$\usig$ analyzes against signature kind $\sigknd$ and elaborates to $\sig$ with hole context $\HoleCtx$}
\end{minipage}
\subsection*{misc}
\begin{align*}
    \val{\sdec} &=
    \begin{cases}
        \lab\TypAssump\typ & \sdec \equiv \ValSdec{\lab}{\typ} \\
        \cdot & \textrm{otherwise} \\
    \end{cases} \\
    \type{\sdec} &=
    \begin{cases}
        \lab\KndAssump\Type & \sdec \equiv \OpaqueTypeSdec{\lab} \\
        \lab\KndAssump\SKind{\typ} & \sdec \equiv \TransparentTypeSdec{\lab}{\typ} \\
        \cdot & \textrm{otherwise} \\
    \end{cases} \\
    \submodule{\sdec} &=
    \begin{cases}
        \lab\SigAssump\sig & \sdec \equiv \ModSdec{\lab}{\sig} \\
        \cdot & \textrm{otherwise} \\
    \end{cases} \\
\end{align*}
\end{document}
