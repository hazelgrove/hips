\documentclass{article}

\usepackage{fullpage}
\usepackage{amsmath, stmaryrd, amssymb, mathtools, mathpartir}

% Sorts

\newcommand{\HExp}{\mathsf{HExp}}
\newcommand{\HTyp}{\mathsf{HTyp}}
\newcommand{\HTag}{\mathsf{HTag}}
\newcommand{\HTagExp}{\mathsf{HTagExp}}
\newcommand{\HTagTyp}{\mathsf{HTagTyp}}
\newcommand{\HTagVar}{\mathsf{HTagVar}}

% Types

\newcommand{\rectype}[2]{\mu #1.#2}
\newcommand{\sumtype}[1]{+\mathopen{}\left\{#1\right\}}

% Tags

\newcommand{\C}{\mathcal{C}}
\newcommand{\Tag}{\mathbf{C}}
\newcommand{\TagHole}[1][u]{{?^{#1}}}

% Expressions

\newcommand{\roll}[2]{\mathtt{roll}^{#1}\mathopen{}\left(#2\right)\mathclose{}}
\newcommand{\unroll}[2]{\mathtt{unroll}^{#1}\mathopen{}\left(#2\right)\mathclose{}}
\newcommand{\inj}[2]{\mathtt{inj}_{#1}\mathopen{}\left(#2\right)\mathclose{}}
\newcommand{\case}[2]{\mathtt{case} \left(#1\right) \left\{#2\right\}}
\newcommand{\hole}[1][]{\llparenthesis#1\rrparenthesis}

% Judgments

\newcommand{\syn}[3]{#1 \vdash #2 \Leftarrow #3}
\newcommand{\ana}[3]{#1 \vdash #2 \Rightarrow #3}
\newcommand{\hastype}[3]{#1 \vdash #2 : #3}

% Operations

\DeclareDocumentCommand{\subst}{m m m}{[#1 / #2]#3}
\DeclareDocumentCommand{\defeq}{}{\stackrel{\text{def}}{=}}
\DeclareDocumentCommand{\isval}{m}{#1~\mathsf{\normalfont val}}

% Helpers

\DeclareMathOperator{\expand}{\text{\normalfont expand}}
\DeclareMathOperator{\join}{\text{\normalfont join}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Algebraic Data Types for Hazel}
\author{Eric Griffis \\ egriffis@umich.edu}
\date{}

\begin{document}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Syntax}

\[
  \arraycolsep=0pt  \arraycolsep=0pt
  \begin{array}{l@{~~}c@{~~}c@{~~}l}
    \HExp & e & {}\Coloneqq{} & \ldots
      \mid \roll{\tau}{e}
      \mid \unroll{\tau}{e}
      \mid \inj{C}{E}
      \mid \case{e}{C_i(X_i){=}e_i}_{C_i \in \C}
    \\
    \HTyp & \tau & {}\Coloneqq{} & \ldots
      \mid (\rectype{\alpha}{\tau})
      \mid \alpha
      \mid \sumtype{C_i(T_i)}_{C_i \in \C}
    \\
    \HTag & C & {}\Coloneqq{} &
      \Tag
      \mid \TagHole
    \\
    \HTagExp & E & {}\Coloneqq{} & e \mid \varnothing \\
    \HTagTyp & T & {}\Coloneqq{} & \tau \mid \varnothing \\
    \HTagVar & X & {}\Coloneqq{} & x \mid \varnothing \\
  \end{array}
\]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Semantics}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 

\noindent
$\boxed{\hastype{\Gamma}{e}{\tau}}$
%
\begin{mathpar}
  \inferrule[TRoll]{
    \hastype{\Gamma}{e}{\expand(\tau)}
  }{
    \hastype{\Gamma}{\roll{\tau}{e}}{\tau}
  }

  \inferrule[TUnroll]{
    \hastype{\Gamma}{e}{\tau}
  }{
    \hastype{\Gamma}{\unroll{\tau}{e}}{\expand(\tau)}
  }

  \inferrule[TNull]{}{
    \hastype{\Gamma}{\varnothing}{\varnothing}
  }

  \inferrule[TInj]{
    \hastype{\Gamma}{E}{T_i}
  }{
    \hastype{\Gamma}{\inj{C_i}{E}}{\sumtype{C_i(T_i)}_{C_i \in \C}}
  }

  \inferrule[TCase]{
    \hastype{\Gamma}{e}{\sumtype{C_i(T_i)}_{C_i \in \C}} \\
    \hastype{\Gamma, X_i : T_i}{e_i}{\tau} \\
    i = 1, \ldots, N
  }{
    \hastype{\Gamma}{
      \case{e}{C_i(X_i){=}e_i}_{C_i \in \C}
    }{\tau}
  }

  \inferrule[TCaseU]{
    \hastype{\Gamma}{e}{\hole} \\
    \hastype{\Gamma, X_i : \hole}{e_i}{\tau} \\
    i = 1, \ldots, N
  }{
    \hastype{\Gamma}{\case{e}{C_i(X_i){=}{e_i}}_{C_i \in \C}}{\tau}
  }
\end{mathpar}

$\expand(\rectype{\alpha}{\tau}) \defeq \subst{\rectype{\alpha}{\tau}}{\alpha}{\tau}$

\vspace*{\baselineskip}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 

\noindent
$\boxed{\syn{\Gamma}{e}{\tau}}$
%
\begin{mathpar}
  \inferrule[TSyn]{
    \ana{\Gamma}{e}{\hole}
  }{
    \syn{\Gamma}{\hole[\inj{C}{e}]}{\hole}
  }
\end{mathpar}

\textsc{TSyn} = Injection in Synthetic Position or Analyzed Against Non-Sum

\vspace*{\baselineskip}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 

\noindent
$\boxed{\ana{\Gamma}{e}{\tau}}$
%
\begin{mathpar}
  \inferrule[TAInj]{
    C_j \in \C
    \\
    \ana{\Gamma}{e}{\tau_j}
  }{
    \ana{\Gamma}{\inj{C_j}{e}}{\sumtype{C_i}{\tau_i}{C_i \in \C}}
  }

  \inferrule[TATag]{
    C \notin \C
    \\
    \ana{\Gamma}{e}{\hole}
  }{
    \ana{\Gamma}{\hole[\inj{C}{e}]}{\sumtype{C_i}{\tau_i}{C_i \in \C}}
  }

  \inferrule[TAHole]{
    \ana{\Gamma}{e}{\hole}
  }{
    \ana{\Gamma}{\inj{C}{e}}{\hole}
  }
\end{mathpar}

\textsc{TATag} = Bad Tag

\textsc{TAHole} = Expected Type is Hole

\vspace*{\baselineskip}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}